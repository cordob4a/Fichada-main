{% extends "base.html" %}
{% block content %}
<h2>Historial de fichadas</h2>

<form method="post">
  <label for="desde">Desde:</label>
  <input type="date" name="desde" value="{{ desde }}">

  <label for="hasta">Hasta:</label>
  <input type="date" name="hasta" value="{{ hasta }}">

  {% if es_admin %}
    <label>Filtrar por email:</label>
    <select name="email">
      <option value="">Todos</option>
      {% for e in emails %}
        <option value="{{ e }}" {% if filtro == e %}selected{% endif %}>{{ e }}</option>
      {% endfor %}
    </select>
  {% endif %}

  <button type="submit">Filtrar</button>
  <a href="{{ url_for('historial') }}">Restablecer</a>
</form>

<p>
  Mostrando historial de:
  {% if es_admin %}
    {{ filtro if filtro else "todos los usuarios" }}
  {% else %}
    {{ email }}
  {% endif %}
</p>

{% if registros %}
  <table>
    <tr><th>Email</th><th>Fichada</th><th>Fecha</th><th>Hora</th><th>Ubicaci√≥n</th></tr>
    {% for r in registros %}
      <tr>
        <td>{{ r['Nombre'] }}</td>
        <td>{{ r['Fichada'] }}</td>
        <td>{{ r['Fecha'] }}</td>
        <td>{{ r['Hora'] }}</td>
        <td>{{ r['Lugar'] }}</td>
      </tr>
    {% endfor %}
  </table>
{% else %}
  <p><em>No se encontraron registros con esos filtros.</em></p>
{% endif %}

<a href="/">Volver al inicio</a>
{% endblock %}